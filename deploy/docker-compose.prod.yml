# SWAPS â€” Production override: SSL volume, no API port exposure
# Run: docker compose -f deploy/docker-compose.yml -f deploy/docker-compose.prod.yml up -d
# Ensure .env has SECRET_KEY, LICENSE_HMAC_SECRET, DB_PASSWORD set (or use Docker secrets).

version: "3.9"

services:
  api:
    # In prod, do not expose 8000 on host; only nginx fronts the app
    ports: []
    environment:
      DATABASE_URL: postgresql+asyncpg://${DB_USER:-swaps}:${DB_PASSWORD}@db:5432/swaps
      SECRET_KEY: ${SECRET_KEY}
      LICENSE_HMAC_SECRET: ${LICENSE_HMAC_SECRET}

  nginx:
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - certbot_conf:/etc/letsencrypt:ro
      - certbot_www:/var/www/certbot:ro

volumes:
  certbot_conf:
  certbot_www:
